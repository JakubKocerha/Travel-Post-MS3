{% extends "base.html" %}
{% block content %}

    <h3 class="center-align blue-grey-text text-lighten-5">Posts</h3>

    <div class="row container">
        <div class="col s12">
            <ul class="collapsible popout">
                {% for post in posts|sort(reverse=true, attribute="_id") %}
                <li>
                    <div class="collapsible-header blue-grey-text text-lighten-5">
                        <div class="row valign-wrapper">
                            <div class="col s12 m3 img-container">
                                <img src="{{ post.image_link }}" alt="{{ post.image_title }}" class="materialboxed responsive-img">
                            </div>
                            <div class="col s12 m6">
                                <h5>{{ post.title_text }}</h5>
                                <span>{{ post.date_post }}</span>
                                <span>Category: {{ post.category_name }}</span>
                                <p>{{ post.summary}}<strong class="strong-color"> ...read more!</strong></p>
                                
                            </div>
                            <div class="col s12 m3">
                                {% if session.user|lower == post.posted_by|lower %}
                                    <a href="{{ url_for('edit_post', post_id=post._id) }}"
                                        class="post-button waves-effect waves-light btn blue-grey-text text-lighten-5 grey darken-2">
                                        Edit
                                    </a>
                                    <!-- Delete button - defensive programming (Ed B_alum - Slack)  -->
                                    <!-- Modal Trigger -->
                                    <button data-target="{{ post._id }}" class="post-button modal-trigger waves-light btn blue-grey-text text-lighten-5 grey darken-2">
                                        Delete
                                    </button>
                                    <!-- Modal Structure -->
                                    <div id="{{ post._id }}" class="modal blue-grey lighten-5">
                                        <div class="modal-content">
                                            <h4 class="delete-color center-align">Are you sure you want to DELETE your post?</h4>
                                        </div>
                                        <div class="modal-footer blue-grey lighten-5">
                                            <a href="{{ url_for('get_posts') }}" class="modal-close btn-flat cancel-btn blue-grey-text text-lighten-5">Cancel</a>
                                            <a href="{{ url_for('delete_post', post_id=post._id) }}" class="modal-close btn-flat blue-grey-text text-lighten-5 grey darken-2">Delete</a>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="collapsible-body blue-grey-text text-lighten-5">
                        <p>{{ post.post_body }}</p>
                        <p>Posted by: {{ post.posted_by }}</p>
                        <p>Email: {{ post.email }}</p>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

{% endblock %}